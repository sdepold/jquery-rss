(function(a){var b=function(a,b,c,d){this.target=a;this.url=b;this.html=[];this.options=jQuery.extend({ssl:false,limit:null,key:null,template:"<ul>{entry}<li><a href='{url}'>[{author}@{date}] {title}</a><br/>{shortBodyPlain}</li>{/entry}</ul>",tokens:{}},c||{});this.callback=d};b.prototype.load=function(b){var c="http"+(this.options.ssl?"s":""),d=c+"://ajax.googleapis.com/ajax/services/feed/load",e=d+"?v=1.0&output=json_xml&callback=?&q="+encodeURIComponent(this.url),f=this;if(this.options.limit!=null)e+="&num="+this.options.limit;if(this.options.key!=null)e+="&key="+this.options.key;a.getJSON(e,b)};b.prototype.render=function(){var b=this,c=b.options.template.match(/\{entry\}(.*)\{\/entry\}/),d=!!c,e=d?c[1]:this.options.template;this.load(function(f){b.entries=f.responseData.feed.entries;jQuery(b.entries).each(function(){var a=this,c=e;if(b.isRelevant(a)){jQuery(e.match(/(\{.*?\})/g)).each(function(){var d=this.toString();c=c.replace(d,b.getValueForToken(d,a))});b.html.push(c)}});var g=b.html.join("\n");if(d)g=b.options.template.replace(c[0],g);else g=jQuery(g).length==0?jQuery("<div>"+g+"</div>"):jQuery(g);b.target.append(g);if(a.isFunction(b.callback)){b.callback.call(this)}})};b.prototype.isRelevant=function(a){var b=this.getTokenMap(a);if(this.options.filter){if(this.options.filterLimit&&this.options.filterLimit==this.html.length){return false}else{return this.options.filter(a,b)}}else{return true}};b.prototype.getTokenMap=function(a){return jQuery.extend({url:a.link,author:a.author,date:a.publishedDate,title:a.title,body:a.content,shortBody:a.contentSnippet,bodyPlain:a.content.replace(/<\/?[^>]+>/gi,""),shortBodyPlain:a.contentSnippet.replace(/<\/?[^>]+>/gi,""),teaserImage:function(a){try{return a.content.match(/(<img.*?>)/gi)[0]}catch(b){return""}},teaserImageUrl:function(a){try{return a.content.match(/(<img.*?>)/gi)[0].match(/src="(.*?)"/)[1]}catch(b){return""}},index:jQuery.inArray(a,this.entries),totalEntries:this.entries.length},this.options.tokens)};b.prototype.getValueForToken=function(a,b){var c=this.getTokenMap(b),d=a.replace(/[\{\}]/g,""),e=c[d];if(typeof e!="undefined")return typeof e=="function"?e(b,c):e;else throw new Error("Unknown token: "+a)};a.fn.rss=function(a,c,d){(new b(this,a,c,d)).render()}})(jQuery)
